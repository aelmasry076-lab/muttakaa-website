<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مُتكأ | Muttakaa</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
        }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #999; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <!-- Scripts loaded in specific order for stability -->
    
    <!-- 1. React & ReactDOM (Production Versions) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Lucide Icons (Must be loaded AFTER React) -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>

    <!-- 3. Firebase Compat Libraries -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- 4. Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        // --- Configuration & Setup ---
        const { useState, useEffect, useMemo } = React;
        
        // Safe destructuring for Icons
        // We use a fallback object to prevent crashing if the library fails to load
        const Icons = window.lucideReact || {};
        const { 
            Users, Heart, Handshake, MapPin, Search, BarChart3, 
            Calendar, ArrowRight, ArrowLeft, Globe, Menu, X, 
            CheckCircle, Clock, FileText, LayoutDashboard, LogOut,
            ChevronRight, ChevronLeft, User
        } = Icons;

        // Fallback Icon component in case Lucide fails entirely
        const FallbackIcon = ({ size = 24, className }) => (
            <div className={`inline-block bg-gray-200 rounded-full ${className}`} style={{width: size, height: size}}></div>
        );

        // Firebase Config
        const firebaseConfig = {
             apiKey: "", // Left empty intentionally
             authDomain: "muttakaa-app.firebaseapp.com",
             projectId: "muttakaa-app",
             storageBucket: "muttakaa-app.appspot.com",
             messagingSenderId: "123456789",
             appId: "1:123456789:web:abcdef"
        };

        // Initialize Firebase
        let auth, db;
        try {
            if (typeof firebase !== 'undefined' && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            if (typeof firebase !== 'undefined') {
                auth = firebase.auth();
                db = firebase.firestore();
            }
        } catch (e) {
            console.warn("Firebase not fully configured, running in mock mode.", e);
        }

        // --- Translations ---
        const translations = {
            ar: {
                brandName: "مُتكأ",
                tagline: "شريكك في التنمية المستدامة",
                nav: { home: "الرئيسية", map: "خريطة الخدمات", impact: "الأثر", events: "الفعاليات", portal: "بوابة المستخدمين" },
                wizard: {
                title: "مرحباً بك في مُتكأ",
                subtitle: "دعنا نساعدك في الوصول لوجهتك الصحيحة",
                iAm: "أنا...",
                volunteer: "متطوع أرغب بالمشاركة",
                partner: "جهة ترغب بالشراكة",
                beneficiary: "أبحث عن خدمة",
                provider: "مقدم خدمة مختص",
                next: "التالي",
                back: "عودة"
                },
                auth: {
                loginTitle: "تسجيل الدخول",
                guest: "دخول كضيف",
                role: "الدور",
                login: "دخول",
                logout: "خروج",
                welcome: "أهلاً بك",
                accessPortal: "الدخول للبوابة"
                },
                dash: {
                title: "لوحة التحكم",
                status: "حالة الطلب",
                skills: "المهارات",
                hours: "ساعات التطوع",
                myRequests: "طلباتي",
                submitReport: "رفع تقرير",
                newRequest: "طلب جديد"
                },
                impact: {
                title: "لوحة الأثر",
                volunteers: "متطوع نشط",
                beneficiaries: "مستفيد",
                partners: "شريك استراتيجي",
                hours: "ساعة عطاء"
                }
            },
            en: {
                brandName: "Muttakaa",
                tagline: "Your Partner in Sustainable Development",
                nav: { home: "Home", map: "Service Map", impact: "Impact", events: "Events", portal: "User Portal" },
                wizard: {
                title: "Welcome to Muttakaa",
                subtitle: "Let us guide you to the right path",
                iAm: "I am a...",
                volunteer: "Volunteer seeking opportunities",
                partner: "Partner seeking collaboration",
                beneficiary: "Beneficiary seeking services",
                provider: "Service Provider",
                next: "Next",
                back: "Back"
                },
                auth: {
                loginTitle: "Login",
                guest: "Continue as Guest",
                role: "Role",
                login: "Login",
                logout: "Logout",
                welcome: "Welcome",
                accessPortal: "Access Portal"
                },
                dash: {
                title: "Dashboard",
                status: "Request Status",
                skills: "Skills",
                hours: "Volunteer Hours",
                myRequests: "My Requests",
                submitReport: "Submit Report",
                newRequest: "New Request"
                },
                impact: {
                title: "Impact Dashboard",
                volunteers: "Active Volunteers",
                beneficiaries: "Beneficiaries",
                partners: "Partners",
                hours: "Giving Hours"
                }
            }
        };

        // --- Main App Component ---
        function MuttakaaApp() {
            const [lang, setLang] = useState('ar');
            const [user, setUser] = useState(null);
            const [userData, setUserData] = useState(null);
            const [view, setView] = useState('home');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const t = translations[lang];

            useEffect(() => {
                if(auth) {
                    const unsubscribe = auth.onAuthStateChanged((u) => {
                        setUser(u);
                    });
                    // Auto sign-in anonymously for demo
                    auth.signInAnonymously().catch(e => console.log("Auth Mocking due to missing config"));
                    return () => unsubscribe();
                } else {
                    // Mock user for offline/demo mode
                    setUser({ uid: "demo-user" });
                }
            }, []);

            // Update HTML dir and lang attributes
            useEffect(() => {
                document.documentElement.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            }, [lang]);

            const navigate = (newView) => {
                setView(newView);
                setMobileMenuOpen(false);
                window.scrollTo(0,0);
            };

            const toggleLang = () => setLang(l => l === 'ar' ? 'en' : 'ar');
            const dir = lang === 'ar' ? 'rtl' : 'ltr';

            // --- Sub-Components ---

            const NavBar = () => (
                <nav className="bg-white shadow-md sticky top-0 z-50">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex justify-between h-20">
                    <div className="flex items-center cursor-pointer" onClick={() => navigate('home')}>
                        <div className="w-10 h-10 bg-teal-600 rounded-tr-xl rounded-bl-xl flex items-center justify-center text-white font-bold text-xl ml-2 mr-2">
                        M
                        </div>
                        <div>
                        <h1 className="text-2xl font-bold text-gray-800">{t.brandName}</h1>
                        <p className="text-xs text-gray-500 hidden sm:block">{t.tagline}</p>
                        </div>
                    </div>

                    {/* Desktop Menu */}
                    <div className="hidden md:flex items-center space-x-4 space-x-reverse">
                        <button onClick={() => navigate('home')} className={`px-3 py-2 rounded-md text-sm font-medium ${view === 'home' ? 'text-teal-600' : 'text-gray-600 hover:text-teal-600'}`}>{t.nav.home}</button>
                        <button onClick={() => navigate('map')} className={`px-3 py-2 rounded-md text-sm font-medium ${view === 'map' ? 'text-teal-600' : 'text-gray-600 hover:text-teal-600'}`}>{t.nav.map}</button>
                        <button onClick={() => navigate('impact')} className={`px-3 py-2 rounded-md text-sm font-medium ${view === 'impact' ? 'text-teal-600' : 'text-gray-600 hover:text-teal-600'}`}>{t.nav.impact}</button>
                        <button onClick={() => navigate('portal')} className="bg-teal-600 text-white px-5 py-2 rounded-full hover:bg-teal-700 transition shadow-lg flex items-center gap-2">
                        {User ? <User size={18} /> : <FallbackIcon size={18} />}
                        {user && userData ? t.auth.welcome : t.nav.portal}
                        </button>
                        <button onClick={toggleLang} className="p-2 text-gray-500 hover:text-teal-600 flex items-center gap-1 font-bold">
                        {Globe ? <Globe size={18} /> : <FallbackIcon size={18} />}
                        {lang === 'ar' ? 'EN' : 'عربي'}
                        </button>
                    </div>

                    {/* Mobile Button */}
                    <div className="flex md:hidden items-center">
                        <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="text-gray-600 p-2">
                        {mobileMenuOpen ? (X ? <X /> : "X") : (Menu ? <Menu /> : "Menu")}
                        </button>
                    </div>
                    </div>
                </div>

                {/* Mobile Menu */}
                {mobileMenuOpen && (
                    <div className="md:hidden bg-white border-t p-4 space-y-2">
                    <button onClick={() => navigate('home')} className="block w-full text-start px-4 py-2 hover:bg-gray-50">{t.nav.home}</button>
                    <button onClick={() => navigate('map')} className="block w-full text-start px-4 py-2 hover:bg-gray-50">{t.nav.map}</button>
                    <button onClick={() => navigate('impact')} className="block w-full text-start px-4 py-2 hover:bg-gray-50">{t.nav.impact}</button>
                    <button onClick={() => navigate('portal')} className="block w-full text-start px-4 py-2 bg-teal-50 text-teal-700 font-bold rounded">{t.nav.portal}</button>
                    <button onClick={toggleLang} className="block w-full text-start px-4 py-2 text-sm text-gray-500 border-t mt-2 pt-2">Switch Language</button>
                    </div>
                )}
                </nav>
            );

            const SmartWizard = () => {
                const [step, setStep] = useState(1);
                const [selection, setSelection] = useState(null);

                const handleSelect = (role) => {
                setSelection(role);
                setTimeout(() => setStep(2), 300);
                };

                const completeWizard = () => {
                setUserData({ role: selection });
                navigate('portal');
                };

                return (
                <div className="bg-gradient-to-br from-teal-50 to-white py-16 px-4">
                    <div className="max-w-4xl mx-auto text-center">
                    <h2 className="text-3xl font-bold text-gray-900 mb-4 animate-fade-in">{t.wizard.title}</h2>
                    <p className="text-xl text-gray-600 mb-12">{t.wizard.subtitle}</p>

                    {step === 1 && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        {[
                            { id: 'volunteer', icon: Heart, label: t.wizard.volunteer, color: 'text-red-500' },
                            { id: 'partner', icon: Handshake, label: t.wizard.partner, color: 'text-blue-500' },
                            { id: 'beneficiary', icon: Users, label: t.wizard.beneficiary, color: 'text-green-500' },
                            { id: 'provider', icon: LayoutDashboard, label: t.wizard.provider, color: 'text-purple-500' },
                        ].map((item) => (
                            <button 
                            key={item.id}
                            onClick={() => handleSelect(item.id)}
                            className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border border-gray-100 flex flex-col items-center group"
                            >
                            <div className={`p-4 rounded-full bg-gray-50 mb-4 group-hover:bg-opacity-20 transition ${item.color.replace('text', 'bg')}`}>
                                {item.icon ? <item.icon className={`w-8 h-8 ${item.color}`} /> : <FallbackIcon className={item.color} />}
                            </div>
                            <h3 className="font-bold text-gray-800">{item.label}</h3>
                            </button>
                        ))}
                        </div>
                    )}

                    {step === 2 && (
                        <div className="bg-white p-8 rounded-2xl shadow-lg max-w-lg mx-auto animate-fade-in-up">
                        <h3 className="text-xl font-bold mb-6">
                            {lang === 'ar' ? `رائع! بصفتك ${t.wizard[selection]}، يمكننا تقديم:` : `Great! As a ${t.wizard[selection]}, we offer:`}
                        </h3>
                        <ul className="space-y-3 mb-8 text-start">
                            {[1, 2, 3].map((_, i) => (
                            <li key={i} className="flex items-center gap-3 text-gray-600">
                                {CheckCircle ? <CheckCircle className="text-teal-500 w-5 h-5 flex-shrink-0" /> : <FallbackIcon size={20} className="text-teal-500" />}
                                <span>
                                {selection === 'volunteer' && i === 0 && (lang === 'ar' ? 'فرص تطوعية تناسب مهاراتك' : 'Opportunities matching your skills')}
                                {selection === 'volunteer' && i === 1 && (lang === 'ar' ? 'توثيق لساعاتك التطوعية' : 'Volunteer hours documentation')}
                                {selection === 'volunteer' && i === 2 && (lang === 'ar' ? 'شهادات معتمدة' : 'Certified certificates')}
                                
                                {selection === 'partner' && i === 0 && (lang === 'ar' ? 'الوصول لتقارير الأثر' : 'Access to impact reports')}
                                {selection === 'partner' && i === 1 && (lang === 'ar' ? 'فرص رعاية البرامج' : 'Sponsorship opportunities')}
                                {selection === 'partner' && i === 2 && (lang === 'ar' ? 'إدارة الشراكات' : 'Partnership management')}
                                
                                {(selection === 'beneficiary' || selection === 'provider') && (lang === 'ar' ? 'خدمات مخصصة وسريعة' : 'Dedicated and fast services')}
                                </span>
                            </li>
                            ))}
                        </ul>
                        <div className="flex gap-4 justify-center">
                            <button onClick={() => setStep(1)} className="px-6 py-3 rounded-lg text-gray-600 hover:bg-gray-100 font-medium">
                            {t.wizard.back}
                            </button>
                            <button onClick={completeWizard} className="px-8 py-3 rounded-lg bg-teal-600 text-white font-bold hover:bg-teal-700 shadow-lg flex items-center gap-2">
                            {t.wizard.next}
                            {lang === 'ar' ? (ArrowLeft ? <ArrowLeft size={18} /> : "<-") : (ArrowRight ? <ArrowRight size={18} /> : "->")}
                            </button>
                        </div>
                        </div>
                    )}
                    </div>
                </div>
                );
            };

            const ServiceMap = () => {
                const [filter, setFilter] = useState('all');
                
                const services = [
                { id: 1, name: "مركز الأمل للاستشارات", type: "consulting", loc: "Riyadh", cost: "$$" },
                { id: 2, name: "جمعية البركة الخيرية", type: "charity", loc: "Jeddah", cost: "Free" },
                { id: 3, name: "معهد التمكين", type: "training", loc: "Dammam", cost: "$" },
                { id: 4, name: "عيادة النفس المطمئنة", type: "health", loc: "Riyadh", cost: "$$$" },
                ];

                const filteredServices = filter === 'all' ? services : services.filter(s => s.type === filter);

                return (
                <div className="min-h-screen bg-gray-50 py-8 px-4">
                    <div className="max-w-6xl mx-auto">
                    <div className="flex flex-col md:flex-row justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold text-gray-800 mb-4 md:mb-0 flex items-center gap-2">
                        {MapPin ? <MapPin className="text-teal-600" /> : <FallbackIcon className="text-teal-600" />}
                        {t.nav.map}
                        </h2>
                        <div className="flex gap-2 bg-white p-2 rounded-lg shadow-sm overflow-x-auto max-w-full">
                        {['all', 'consulting', 'charity', 'training', 'health'].map(f => (
                            <button 
                            key={f}
                            onClick={() => setFilter(f)}
                            className={`px-4 py-2 rounded-md text-sm whitespace-nowrap ${filter === f ? 'bg-teal-600 text-white' : 'hover:bg-gray-100 text-gray-600'}`}
                            >
                            {f === 'all' ? (lang === 'ar' ? 'الكل' : 'All') : f}
                            </button>
                        ))}
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {/* Map Placeholder */}
                        <div className="md:col-span-2 bg-slate-200 rounded-2xl min-h-[400px] relative overflow-hidden flex items-center justify-center group">
                            <div className="absolute inset-0 bg-gray-300 bg-opacity-30 group-hover:bg-opacity-40 transition"></div>
                            <div className="text-center z-10 p-6 bg-white/90 backdrop-blur rounded-xl shadow-lg">
                            {MapPin && <MapPin className="w-12 h-12 text-teal-600 mx-auto mb-2" />}
                            <p className="font-bold text-gray-700">{lang === 'ar' ? 'خريطة تفاعلية' : 'Interactive Map'}</p>
                            <p className="text-xs text-gray-500">{lang === 'ar' ? 'يمكن دمج Google Maps API هنا' : 'Google Maps API integration spot'}</p>
                            </div>
                        </div>

                        {/* List View */}
                        <div className="space-y-4 h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                        {filteredServices.map(s => (
                            <div key={s.id} className="bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border-l-4 border-teal-500 flex justify-between items-center">
                            <div>
                                <h3 className="font-bold text-gray-800">{s.name}</h3>
                                <p className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                                {MapPin && <MapPin size={12} />} {s.loc} • <span className="bg-gray-100 px-2 rounded text-xs">{s.type}</span>
                                </p>
                            </div>
                            <button className="text-teal-600 bg-teal-50 p-2 rounded-full hover:bg-teal-100">
                                {lang === 'ar' ? (ChevronLeft ? <ChevronLeft /> : "<") : (ChevronRight ? <ChevronRight /> : ">")}
                            </button>
                            </div>
                        ))}
                        </div>
                    </div>
                    </div>
                </div>
                );
            };

            const Portal = () => {
                if (!userData) {
                return (
                    <div className="min-h-[60vh] flex items-center justify-center bg-gray-50 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center">
                        <div className="w-16 h-16 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        {User ? <User size={32} /> : <FallbackIcon size={32} />}
                        </div>
                        <h2 className="text-2xl font-bold mb-2">{t.auth.loginTitle}</h2>
                        <p className="text-gray-500 mb-8">{lang === 'ar' ? 'يرجى اختيار نوع حسابك للمتابعة' : 'Please select your account type to continue'}</p>
                        
                        <div className="space-y-3">
                        <button onClick={() => setUserData({ role: 'volunteer' })} className="w-full p-4 border rounded-xl hover:bg-teal-50 hover:border-teal-500 transition flex items-center gap-3">
                            {Heart && <Heart className="text-red-500" />}
                            <div className="text-start">
                            <span className="block font-bold text-gray-800">{t.wizard.volunteer}</span>
                            </div>
                        </button>
                        <button onClick={() => setUserData({ role: 'provider' })} className="w-full p-4 border rounded-xl hover:bg-teal-50 hover:border-teal-500 transition flex items-center gap-3">
                            {LayoutDashboard && <LayoutDashboard className="text-purple-500" />}
                            <div className="text-start">
                            <span className="block font-bold text-gray-800">{t.wizard.provider}</span>
                            </div>
                        </button>
                        </div>
                    </div>
                    </div>
                );
                }

                if (userData.role === 'volunteer') {
                return (
                    <div className="max-w-7xl mx-auto py-8 px-4">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold text-gray-800">{lang === 'ar' ? 'لوحة المتطوع' : 'Volunteer Dashboard'}</h2>
                        <button onClick={() => setUserData(null)} className="text-red-500 flex items-center gap-2 hover:bg-red-50 px-3 py-1 rounded-lg">
                        {LogOut ? <LogOut size={16} /> : "Logout"} {t.auth.logout}
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div className="bg-white p-6 rounded-xl shadow-sm border-t-4 border-teal-500">
                        <p className="text-gray-500 text-sm">{t.dash.hours}</p>
                        <p className="text-3xl font-bold text-gray-900 mt-2">24</p>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border-t-4 border-orange-500">
                        <p className="text-gray-500 text-sm">{t.dash.status}</p>
                        <p className="text-xl font-bold text-orange-600 mt-2">{lang === 'ar' ? 'نشط' : 'Active'}</p>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border-t-4 border-blue-500 md:col-span-2">
                        <p className="text-gray-500 text-sm mb-2">{lang === 'ar' ? 'الفرص القادمة' : 'Upcoming Opportunities'}</p>
                        <div className="flex items-center gap-3 bg-blue-50 p-2 rounded-lg">
                            {Calendar && <Calendar size={20} className="text-blue-600" />}
                            <span className="text-sm font-medium">{lang === 'ar' ? 'تنظيف الشاطئ - 25 أكتوبر' : 'Beach Cleanup - Oct 25'}</span>
                            <button className="mr-auto bg-blue-600 text-white text-xs px-3 py-1 rounded">{lang === 'ar' ? 'تأكيد' : 'Confirm'}</button>
                        </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-sm p-6">
                        <h3 className="text-xl font-bold mb-6 border-b pb-2">{lang === 'ar' ? 'المهام الحالية' : 'Current Tasks'}</h3>
                        <div className="space-y-4">
                        {[1, 2].map(i => (
                            <div key={i} className="flex flex-col md:flex-row justify-between items-start md:items-center p-4 border rounded-lg hover:bg-gray-50">
                            <div>
                                <h4 className="font-bold text-gray-800">{lang === 'ar' ? 'مساعدة في تنظيم ورشة عمل' : 'Help organize workshop'}</h4>
                                <p className="text-sm text-gray-500">Ticket ID: #VOL-2024-{i}99</p>
                            </div>
                            <span className="px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold mt-2 md:mt-0">
                                In Progress
                            </span>
                            </div>
                        ))}
                        </div>
                    </div>
                    </div>
                );
                }

                if (userData.role === 'provider') {
                    return (
                    <div className="max-w-7xl mx-auto py-8 px-4">
                        <div className="flex justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold text-gray-800">{lang === 'ar' ? 'بوابة مقدمي الخدمات' : 'Provider Portal'}</h2>
                        <button onClick={() => setUserData(null)} className="text-red-500 flex items-center gap-2 hover:bg-red-50 px-3 py-1 rounded-lg">
                            {LogOut ? <LogOut size={16} /> : "Logout"} {t.auth.logout}
                        </button>
                        </div>
            
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="space-y-6">
                            <div className="bg-white p-6 rounded-xl shadow-sm">
                            <h3 className="font-bold text-gray-500 text-sm mb-4 uppercase">{lang === 'ar' ? 'نظرة عامة' : 'Overview'}</h3>
                            <div className="flex justify-between items-center mb-4">
                                <span>{t.dash.newRequest}</span>
                                <span className="bg-red-100 text-red-600 font-bold px-2 rounded">5</span>
                            </div>
                            <div className="flex justify-between items-center">
                                <span>{lang === 'ar' ? 'الخدمات النشطة' : 'Active Services'}</span>
                                <span className="font-bold">3</span>
                            </div>
                            </div>
                            
                            <div className="bg-teal-600 p-6 rounded-xl shadow-lg text-white">
                                <h3 className="font-bold mb-2">{lang === 'ar' ? 'هل تريد إضافة خدمة؟' : 'Add new Service?'}</h3>
                                <button className="w-full bg-white text-teal-700 font-bold py-2 rounded-lg mt-2 text-sm hover:bg-gray-100">
                                {lang === 'ar' ? '+ إضافة خدمة جديدة' : '+ Add Service'}
                                </button>
                            </div>
                        </div>
            
                        <div className="lg:col-span-2 bg-white rounded-xl shadow-sm overflow-hidden">
                            <div className="p-6 border-b flex justify-between items-center">
                            <h3 className="font-bold text-xl">{lang === 'ar' ? 'طلبات الإحالة الواردة' : 'Incoming Referrals'}</h3>
                            <div className="flex gap-2">
                                <button className="p-2 hover:bg-gray-100 rounded text-gray-500">{Search ? <Search size={18} /> : "?"}</button>
                            </div>
                            </div>
                            <div className="divide-y">
                            {[1, 2, 3].map(req => (
                                <div key={req} className="p-6 hover:bg-gray-50 transition">
                                <div className="flex justify-between items-start">
                                    <div className="flex gap-4">
                                    <div className="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600">
                                        U{req}
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-gray-800">{lang === 'ar' ? 'طلب استشارة عائلية' : 'Family Consultation Request'}</h4>
                                        <p className="text-sm text-gray-500">{lang === 'ar' ? 'من: أحمد محمد' : 'From: Ahmed M.'} • 2 hours ago</p>
                                    </div>
                                    </div>
                                    <div className="flex gap-2">
                                    <button className="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-white hover:border-red-500 hover:text-red-500 transition">{lang === 'ar' ? 'رفض' : 'Decline'}</button>
                                    <button className="px-3 py-1 text-sm bg-teal-600 text-white rounded hover:bg-teal-700 transition shadow">{lang === 'ar' ? 'قبول' : 'Accept'}</button>
                                    </div>
                                </div>
                                </div>
                            ))}
                            </div>
                        </div>
                        </div>
                    </div>
                    );
                }

                return null;
            };

            const ImpactDashboard = () => (
                <div className="bg-gray-50 py-12 px-4 min-h-screen">
                <div className="max-w-7xl mx-auto">
                    <h2 className="text-4xl font-bold text-center mb-12 text-gray-800">{t.impact.title}</h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16">
                    {[
                        { label: t.impact.volunteers, val: "1,250", icon: Users, color: "text-blue-500", bg: "bg-blue-100" },
                        { label: t.impact.beneficiaries, val: "5,430", icon: Heart, color: "text-red-500", bg: "bg-red-100" },
                        { label: t.impact.hours, val: "12K+", icon: Clock, color: "text-green-500", bg: "bg-green-100" },
                        { label: t.impact.partners, val: "45", icon: Handshake, color: "text-purple-500", bg: "bg-purple-100" },
                    ].map((stat, idx) => (
                        <div key={idx} className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-lg transition text-center group">
                        <div className={`w-16 h-16 ${stat.bg} ${stat.color} rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition duration-300`}>
                            {stat.icon ? <stat.icon size={32} /> : <FallbackIcon size={32} />}
                        </div>
                        <h3 className="text-4xl font-extrabold text-gray-900 mb-2">{stat.val}</h3>
                        <p className="text-gray-500 font-medium">{stat.label}</p>
                        </div>
                    ))}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div className="bg-white p-6 rounded-2xl shadow-sm">
                        <h3 className="font-bold mb-6 text-gray-800 text-lg flex items-center gap-2">
                        {BarChart3 && <BarChart3 className="text-teal-600" />}
                        {lang === 'ar' ? 'نمو التطوع (شهري)' : 'Volunteer Growth (Monthly)'}
                        </h3>
                        <div className="flex items-end justify-between h-48 px-4 gap-2">
                        {[40, 65, 45, 80, 55, 90].map((h, i) => (
                            <div key={i} className="w-full bg-teal-100 rounded-t-lg hover:bg-teal-500 transition-colors relative group" style={{ height: `${h}%` }}>
                            <span className="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition">{h * 10}</span>
                            </div>
                        ))}
                        </div>
                        <div className="flex justify-between mt-2 text-xs text-gray-400">
                        <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span>
                        </div>
                    </div>
                    
                    <div className="bg-white p-6 rounded-2xl shadow-sm flex flex-col justify-center">
                        <h3 className="font-bold mb-4 text-gray-800 text-lg">{lang === 'ar' ? 'توزع الخدمات' : 'Service Distribution'}</h3>
                        <div className="space-y-4">
                        {[
                            { label: 'Training', pct: '45%', color: 'bg-blue-500' },
                            { label: 'Consulting', pct: '30%', color: 'bg-purple-500' },
                            { label: 'Charity', pct: '25%', color: 'bg-orange-500' },
                        ].map((item, i) => (
                            <div key={i}>
                            <div className="flex justify-between text-sm mb-1 text-gray-600 font-medium">
                                <span>{item.label}</span>
                                <span>{item.pct}</span>
                            </div>
                            <div className="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                <div className={`h-full ${item.color}`} style={{ width: item.pct }}></div>
                            </div>
                            </div>
                        ))}
                        </div>
                    </div>
                    </div>
                </div>
                </div>
            );

            // Main Render
            return (
                <div className="min-h-screen bg-gray-50 text-gray-900">
                    <NavBar />
                    <main className="animate-fade-in">
                        {view === 'home' && (
                        <>
                            <SmartWizard />
                            <div className="py-16 text-center">
                            <h3 className="text-2xl font-bold mb-8 text-gray-800">{lang === 'ar' ? 'لماذا مُتكأ؟' : 'Why Muttakaa?'}</h3>
                            <div className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 px-4">
                                {[1, 2, 3].map(i => (
                                <div key={i} className="bg-white p-6 rounded-xl shadow-sm">
                                    <div className="w-12 h-12 bg-teal-100 rounded-full mb-4 mx-auto"></div>
                                    <h4 className="font-bold mb-2">{lang === 'ar' ? 'أثر مستدام' : 'Sustainable Impact'}</h4>
                                    <p className="text-sm text-gray-500">منصة متكاملة لخدمة المجتمع وتحقيق التنمية.</p>
                                </div>
                                ))}
                            </div>
                            </div>
                        </>
                        )}
                        {view === 'map' && <ServiceMap />}
                        {view === 'impact' && <ImpactDashboard />}
                        {view === 'portal' && <Portal />}
                    </main>

                    <footer className="bg-gray-800 text-gray-300 py-12 mt-auto">
                        <div className="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
                        <div>
                            <h2 className="text-white text-xl font-bold mb-4">{t.brandName}</h2>
                            <p className="text-sm text-gray-400">{t.tagline}</p>
                        </div>
                        <div>
                            <h3 className="font-bold text-white mb-4">{lang === 'ar' ? 'روابط سريعة' : 'Quick Links'}</h3>
                            <ul className="space-y-2 text-sm">
                            <li><button onClick={() => navigate('home')} className="hover:text-teal-400">{t.nav.home}</button></li>
                            <li><button onClick={() => navigate('impact')} className="hover:text-teal-400">{t.nav.impact}</button></li>
                            <li><button onClick={() => navigate('portal')} className="hover:text-teal-400">{t.nav.portal}</button></li>
                            </ul>
                        </div>
                        <div>
                            <h3 className="font-bold text-white mb-4">{lang === 'ar' ? 'تواصل معنا' : 'Contact Us'}</h3>
                            <p className="text-sm text-gray-400">Muttakaa.sd@gmail.com</p>
                            <p className="text-sm text-gray-400" dir="ltr">01020082100 / 01055165556</p>
                        </div>
                        </div>
                        <div className="text-center text-xs text-gray-500 mt-12 pt-8 border-t border-gray-700">
                        © 2024 Muttakaa. All rights reserved.
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MuttakaaApp />);
    </script>
</body>
</html>
